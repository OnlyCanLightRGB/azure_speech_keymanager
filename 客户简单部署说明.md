# Azure Speech Key Manager 客户部署说明

## 🚀 一键部署（推荐）

### 前提条件
- 已安装 Docker 和 Docker Compose
- 端口 3000 和 3019 未被占用

### 部署步骤

1. **获取代码**
   ```bash
   git pull
   ```

2. **一键启动**
   ```bash
   docker-compose build && docker-compose up -d
   ```

3. **验证部署**
   - 前端界面：http://localhost:3000
   - 后端API：http://localhost:3019/api/health

### 就这么简单！🎉

---

## 📋 部署说明

### ✅ 已自动处理的配置
- ✅ 数据库初始化（MySQL 5.7）
- ✅ Redis缓存配置
- ✅ 所有必需的目录创建
- ✅ 环境变量配置
- ✅ 服务健康检查
- ✅ 字符集编码（UTF-8支持中文）
- ✅ 定时任务调度器

### 📁 自动创建的Docker卷
- `mysql_azkm_data` - 数据库数据持久化
- `redis_azkm_data` - Redis数据持久化  
- `app_logs` - 应用日志
- `app_uploads` - 文件上传
- `app_backups` - 数据库备份

### 🔧 可选配置（不影响基本功能）
如需要以下功能，可编辑 `.env.docker` 文件：

```bash
# Azure账单查询功能（可选）
# AZURE_CLIENT_ID=your_client_id
# AZURE_CLIENT_SECRET=your_client_secret  
# AZURE_TENANT_ID=your_tenant_id
# AZURE_SUBSCRIPTION_ID=your_subscription_id

# 飞书通知功能（可选）
# FEISHU_WEBHOOK_URL=your_webhook_url
# TRANSLATION_FEISHU_WEBHOOK_URL=your_translation_webhook_url
```

---

## 🛠️ 常用管理命令

```bash
# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs app

# 重启服务
docker-compose restart

# 停止服务
docker-compose down

# 完全重新部署
docker-compose down -v && docker-compose build && docker-compose up -d
```

---

## 🔍 故障排除

### 端口占用问题
```bash
# 检查端口占用
lsof -i :3000
lsof -i :3019

# 修改端口（如需要）
# 编辑 docker-compose.yml 中的端口映射
```

### 服务启动失败
```bash
# 查看详细日志
docker-compose logs app --tail 50

# 检查健康状态
curl http://localhost:3019/api/health
```

### 数据库问题
```bash
# 进入数据库容器
docker-compose exec mysql_azkm mysql -u root -prootpassword azure_speech_keymanager

# 检查表结构
SHOW TABLES;
```

---

## 📞 技术支持

如遇到问题，请提供以下信息：
1. 错误日志：`docker-compose logs app --tail 100`
2. 服务状态：`docker-compose ps`
3. 系统信息：`docker --version && docker-compose --version`

---

## 🎯 核心功能验证

部署完成后，可以通过以下方式验证核心功能：

1. **访问前端界面**：http://localhost:3000
2. **健康检查**：http://localhost:3019/api/health
3. **上传Azure密钥文件**测试语音转文字功能
4. **查看系统日志**确认定时任务正常运行

系统已配置为生产环境，具备完整的错误处理、日志记录和自动恢复功能。
